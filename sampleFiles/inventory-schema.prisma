generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Warehouse {
  id        String   @id @default(cuid())
  name      String
  code      String   @unique
  address   String
  city      String
  country   String
  capacity  Int
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  zones          Zone[]
  inboundOrders  TransferOrder[] @relation("InboundWarehouse")
  outboundOrders TransferOrder[] @relation("OutboundWarehouse")
  staff          WarehouseStaff[]

  @@index([country, city])
}

model Zone {
  id          String   @id @default(cuid())
  name        String
  zoneType    ZoneType
  temperature Float?
  warehouseId String
  warehouse   Warehouse @relation(fields: [warehouseId], references: [id])

  shelves Shelf[]

  @@unique([warehouseId, name])
}

enum ZoneType {
  AMBIENT
  COLD_STORAGE
  HAZMAT
  OVERSIZED
  RETURNS
}

model Shelf {
  id       String @id @default(cuid())
  label    String
  row      Int
  column   Int
  maxWeight Float
  zoneId   String
  zone     Zone   @relation(fields: [zoneId], references: [id])

  inventory InventorySlot[]

  @@unique([zoneId, row, column])
}

model Product {
  id          String   @id @default(cuid())
  sku         String   @unique
  name        String
  description String?
  weight      Float
  categoryId  String
  category    Category @relation(fields: [categoryId], references: [id])
  supplierId  String
  supplier    Supplier @relation(fields: [supplierId], references: [id])
  createdAt   DateTime @default(now())

  inventorySlots InventorySlot[]
  orderItems     TransferOrderItem[]

  @@index([sku])
  @@index([categoryId])
}

model Category {
  id       String    @id @default(cuid())
  name     String    @unique
  parentId String?
  parent   Category? @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children Category[] @relation("CategoryHierarchy")

  products Product[]
}

model Supplier {
  id           String   @id @default(cuid())
  name         String
  contactEmail String
  contactPhone String?
  rating       Float    @default(0)
  isActive     Boolean  @default(true)

  products Product[]
}

model InventorySlot {
  id        String   @id @default(cuid())
  quantity  Int
  shelfId   String
  shelf     Shelf    @relation(fields: [shelfId], references: [id])
  productId String
  product   Product  @relation(fields: [productId], references: [id])
  lotNumber String?
  expiresAt DateTime?
  updatedAt DateTime @updatedAt

  @@unique([shelfId, productId, lotNumber])
  @@index([productId])
}

model TransferOrder {
  id                String            @id @default(cuid())
  orderNumber       String            @unique
  status            TransferStatus    @default(PENDING)
  fromWarehouseId   String
  fromWarehouse     Warehouse         @relation("OutboundWarehouse", fields: [fromWarehouseId], references: [id])
  toWarehouseId     String
  toWarehouse       Warehouse         @relation("InboundWarehouse", fields: [toWarehouseId], references: [id])
  requestedBy       String
  approvedBy        String?
  createdAt         DateTime          @default(now())
  completedAt       DateTime?

  items TransferOrderItem[]

  @@index([status])
  @@index([fromWarehouseId])
  @@index([toWarehouseId])
}

enum TransferStatus {
  PENDING
  APPROVED
  IN_TRANSIT
  DELIVERED
  CANCELLED
}

model TransferOrderItem {
  id              String        @id @default(cuid())
  transferOrderId String
  transferOrder   TransferOrder @relation(fields: [transferOrderId], references: [id], onDelete: Cascade)
  productId       String
  product         Product       @relation(fields: [productId], references: [id])
  quantity        Int
  receivedQty     Int?

  @@unique([transferOrderId, productId])
}

model WarehouseStaff {
  id          String    @id @default(cuid())
  userId      String
  warehouseId String
  warehouse   Warehouse @relation(fields: [warehouseId], references: [id])
  role        StaffRole
  assignedAt  DateTime  @default(now())

  @@unique([userId, warehouseId])
}

enum StaffRole {
  MANAGER
  SUPERVISOR
  PICKER
  RECEIVER
  AUDITOR
}
