datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Venue {
  id          String   @id @default(cuid())
  name        String
  address     String
  city        String
  capacity    Int
  hourlyRate  Decimal  @db.Decimal(10, 2)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  rooms       Room[]
  bookings    Booking[]

  @@index([city])
  @@index([isActive])
}

model Room {
  id          String   @id @default(cuid())
  name        String
  floor       Int
  capacity    Int
  amenities   String[] @default([])
  venueId     String

  venue       Venue    @relation(fields: [venueId], references: [id], onDelete: Cascade)
  bookings    Booking[]

  @@unique([venueId, name])
  @@index([capacity])
}

model Customer {
  id            String   @id @default(cuid())
  email         String   @unique
  name          String
  phone         String?
  organization  String?
  tier          CustomerTier @default(STANDARD)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  bookings      Booking[]
  payments      Payment[]

  @@index([email])
  @@index([organization])
}

enum CustomerTier {
  STANDARD
  PREMIUM
  ENTERPRISE
}

model Booking {
  id            String        @id @default(cuid())
  status        BookingStatus @default(PENDING)
  startTime     DateTime
  endTime       DateTime
  attendeeCount Int
  notes         String?
  totalAmount   Decimal       @db.Decimal(10, 2)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  customerId    String
  venueId       String
  roomId        String?

  customer      Customer      @relation(fields: [customerId], references: [id])
  venue         Venue         @relation(fields: [venueId], references: [id])
  room          Room?         @relation(fields: [roomId], references: [id])
  payments      Payment[]
  addOns        BookingAddOn[]

  @@index([customerId])
  @@index([venueId])
  @@index([status])
  @@index([startTime, endTime])
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  NO_SHOW
}

model Payment {
  id            String        @id @default(cuid())
  amount        Decimal       @db.Decimal(10, 2)
  method        PaymentMethod
  status        PaymentStatus @default(PENDING)
  transactionId String?       @unique
  processedAt   DateTime?
  createdAt     DateTime      @default(now())

  bookingId     String
  customerId    String

  booking       Booking       @relation(fields: [bookingId], references: [id])
  customer      Customer      @relation(fields: [customerId], references: [id])
  refund        Refund?

  @@index([bookingId])
  @@index([customerId])
  @@index([status])
}

enum PaymentMethod {
  CREDIT_CARD
  DEBIT_CARD
  BANK_TRANSFER
  INVOICE
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  REFUNDED
}

model Refund {
  id          String       @id @default(cuid())
  amount      Decimal      @db.Decimal(10, 2)
  reason      String
  status      RefundStatus @default(PENDING)
  processedAt DateTime?
  createdAt   DateTime     @default(now())

  paymentId   String       @unique
  payment     Payment      @relation(fields: [paymentId], references: [id])
}

enum RefundStatus {
  PENDING
  APPROVED
  PROCESSED
  REJECTED
}

model AddOn {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  price       Decimal  @db.Decimal(10, 2)
  category    String
  isActive    Boolean  @default(true)

  bookings    BookingAddOn[]

  @@index([category])
}

model BookingAddOn {
  id        String @id @default(cuid())
  quantity  Int    @default(1)

  bookingId String
  addOnId   String

  booking   Booking @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  addOn     AddOn   @relation(fields: [addOnId], references: [id])

  @@unique([bookingId, addOnId])
}
